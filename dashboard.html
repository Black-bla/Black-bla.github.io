<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard | Black-bla</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css" />
  <style>
    .dashboard-wrapper{min-height:100svh;padding:2rem 1rem 4rem;max-width:1200px;margin:0 auto}
    .dashboard-header{text-align:center;margin-bottom:3rem}
    .dashboard-header h1{margin:0 0 .6rem;font-size:2.5rem;background:var(--gradient-accent);-webkit-background-clip:text;color:transparent}
    .dashboard-grid{display:grid;gap:2rem;grid-template-columns:repeat(auto-fit,minmax(320px,1fr))}
    .dashboard-card{background:linear-gradient(to bottom right,rgba(255,255,255,0.08),rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.12);border-radius:var(--radius);padding:2rem 1.8rem;backdrop-filter:blur(18px);position:relative;overflow:hidden}
    .dashboard-card::before{content:'';position:absolute;inset:0;background:radial-gradient(circle at 20% 0%,rgba(255,255,255,0.25),transparent 60%);opacity:0;transition:opacity .6s;pointer-events:none}
    .dashboard-card:hover::before{opacity:.3}
    .card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem}
    .card-title{font-size:1.1rem;font-weight:600;margin:0}
    .card-icon{font-size:1.5rem;opacity:.7}
    .info-grid{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(140px,1fr))}
    .info-block{padding:1.2rem 1rem;border-radius:var(--radius-sm);background:linear-gradient(to bottom right,rgba(255,255,255,0.07),rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.15);text-align:center}
    .info-number{font-size:1.8rem;font-weight:700;background:var(--gradient-accent);-webkit-background-clip:text;color:transparent;display:block;margin-bottom:.3rem}
    .info-label{font-size:.75rem;letter-spacing:.5px;text-transform:uppercase;color:var(--text-soft);font-weight:500}
    .activity-list{list-style:none;margin:0;padding:0;display:grid;gap:.8rem}
    .activity-item{padding:.8rem 1rem;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius-sm);font-size:.85rem}
    .activity-time{color:var(--text-soft);font-size:.75rem;margin-top:.3rem}
    .settings-section{display:grid;gap:1.2rem}
    .setting-item{display:flex;align-items:center;justify-content:space-between;padding:1rem;background:rgba(255,255,255,0.03);border-radius:var(--radius-sm);border:1px solid rgba(255,255,255,0.08)}
    .quick-actions{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:1rem;margin-bottom:2rem}
    .quick-action{padding:1.2rem;text-align:center;border:1px solid rgba(255,255,255,0.12);border-radius:var(--radius);background:linear-gradient(to bottom right,rgba(255,255,255,0.05),rgba(255,255,255,0.01));text-decoration:none;color:var(--text);transition:all .3s;cursor:pointer}
    .quick-action:hover{background:linear-gradient(to bottom right,rgba(255,255,255,0.12),rgba(255,255,255,0.04));transform:translateY(-2px)}
    .action-icon{font-size:1.8rem;margin-bottom:.6rem;display:block}
    .action-label{font-size:.8rem;font-weight:500}
    .profile-avatar{width:80px;height:80px;border-radius:50%;background:var(--gradient-accent);display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:700;color:white;margin:0 auto 1rem}
    .user-info-block{padding:1rem .9rem .85rem;border-radius:var(--radius-sm);background:linear-gradient(to bottom right,rgba(255,255,255,0.07),rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.15);font-size:.75rem;letter-spacing:.5px;text-transform:uppercase;color:var(--text-soft);display:flex;flex-direction:column;gap:.4rem}
    .user-info-block span{font-size:.95rem;letter-spacing:0;text-transform:none;color:var(--text);font-weight:500;word-break:break-all}
    .progress-bar{width:100%;height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden;margin-top:.5rem}
    .progress-fill{height:100%;background:var(--gradient-accent);border-radius:4px;transition:width 1s ease}
    @media (max-width: 768px) {
      .dashboard-grid{grid-template-columns:1fr}
      .quick-actions{grid-template-columns:repeat(2,1fr)}
      .info-grid{grid-template-columns:repeat(2,1fr)}
    }
  </style>
</head>
<body>
  <canvas id="bg-canvas" aria-hidden="true"></canvas>
  <header class="site-header">
    <div class="logo"><a href="/" style="text-decoration:none;color:inherit">&lt;Black-bla /&gt;</a></div>
    <nav class="nav" aria-label="Primary">
      <button class="nav__toggle" aria-label="Menu" aria-expanded="false">‚ò∞</button>
      <ul class="nav__list">
        <li><a href="/">Home</a></li>
        <li><a href="dashboard.html" style="color:var(--accent)">Dashboard</a></li>
        <li><button id="logoutBtn" class="btn outline" style="padding:.45rem .9rem;font-size:.7rem">Logout</button></li>
      </ul>
    </nav>
    <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode">üåô</button>
  </header>

  <main class="dashboard-wrapper">
    <div class="dashboard-header">
      <h1>Dashboard</h1>
      <p class="muted" id="welcomeMsg">Loading your personalized dashboard...</p>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <a href="#profile" class="quick-action">
        <span class="action-icon">üë§</span>
        <span class="action-label">Profile</span>
      </a>
      <a href="#" class="quick-action" onclick="exportData()">
        <span class="action-icon">üìä</span>
        <span class="action-label">Export Data</span>
      </a>
      <a href="#settings" class="quick-action">
        <span class="action-icon">‚öôÔ∏è</span>
        <span class="action-label">Settings</span>
      </a>
      <a href="/" class="quick-action">
        <span class="action-icon">üè†</span>
        <span class="action-label">Portfolio</span>
      </a>
    </div>

    <div class="dashboard-grid">
      <!-- User Profile Card -->
      <div class="dashboard-card" id="profileCard">
        <div class="card-header">
          <h2 class="card-title">Profile</h2>
          <span class="card-icon">üë§</span>
        </div>
        <div class="profile-avatar" id="userAvatar">U</div>
        <div class="info-grid" id="userInfoGrid" style="display:none">
          <div class="user-info-block">User ID <span id="infoId">‚Äî</span></div>
          <div class="user-info-block">Name <span id="infoName">‚Äî</span></div>
          <div class="user-info-block">Email <span id="infoEmail">‚Äî</span></div>
          <div class="user-info-block">Status <span id="infoStatus">‚Äî</span></div>
        </div>
        <div id="nameUpdateSection" style="margin-top:1.5rem">
          <h3 style="margin:0 0 1rem;font-size:1rem">Update Name</h3>
          <form id="nameForm" class="contact-form" style="padding:0;background:none;border:none;box-shadow:none">
            <div class="field" style="margin:0 0 .8rem">
              <input id="newName" name="newName" type="text" placeholder="Enter new name" minlength="2" style="margin-bottom:.5rem" />
            </div>
            <button class="btn outline" type="submit" style="width:auto;font-size:.8rem">Update Name</button>
            <p class="form-status" id="nameStatus" role="status" aria-live="polite"></p>
          </form>
        </div>
      </div>

      <!-- Account Statistics -->
      <div class="dashboard-card">
        <div class="card-header">
          <h2 class="card-title">Account Stats</h2>
          <span class="card-icon">üìà</span>
        </div>
        <div class="info-grid">
          <div class="info-block">
            <span class="info-number" id="statDays">0</span>
            <span class="info-label">Days Active</span>
          </div>
          <div class="info-block">
            <span class="info-number" id="statLogins">0</span>
            <span class="info-label">Total Logins</span>
          </div>
          <div class="info-block">
            <span class="info-number" id="statUpdates">0</span>
            <span class="info-label">Profile Updates</span>
          </div>
          <div class="info-block">
            <span class="info-number" id="statScore">0</span>
            <span class="info-label">Activity Score</span>
          </div>
        </div>
        <div style="margin-top:1.5rem">
          <p style="font-size:.8rem;color:var(--text-soft);margin:0 0 .5rem">Account Completion</p>
          <div class="progress-bar">
            <div class="progress-fill" id="completionProgress" style="width:0%"></div>
          </div>
          <p style="font-size:.75rem;color:var(--text-soft);margin:.3rem 0 0;text-align:center" id="completionText">0% Complete</p>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="dashboard-card">
        <div class="card-header">
          <h2 class="card-title">Recent Activity</h2>
          <span class="card-icon">üïê</span>
        </div>
        <ul class="activity-list" id="activityList">
          <li class="activity-item">
            Welcome to your dashboard! üéâ
            <div class="activity-time">Just now</div>
          </li>
        </ul>
      </div>

      <!-- Settings & Preferences -->
      <div class="dashboard-card">
        <div class="card-header">
          <h2 class="card-title">Settings</h2>
          <span class="card-icon">‚öôÔ∏è</span>
        </div>
        <div class="settings-section">
          <div class="setting-item">
            <span>Dark Mode</span>
            <button id="settingsThemeToggle" class="btn outline" style="padding:.3rem .6rem;font-size:.75rem">Toggle</button>
          </div>
          <div class="setting-item">
            <span>Email Notifications</span>
            <button class="btn outline" style="padding:.3rem .6rem;font-size:.75rem" onclick="toggleNotifications()">Enable</button>
          </div>
          <div class="setting-item">
            <span>Two-Factor Auth</span>
            <button class="btn outline" style="padding:.3rem .6rem;font-size:.75rem" onclick="setup2FA()">Setup</button>
          </div>
          <div class="setting-item">
            <span>Export Data</span>
            <button class="btn outline" style="padding:.3rem .6rem;font-size:.75rem" onclick="exportData()">Download</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script type="module">
    import './assets/js/app.js';
    import { account, handleAppwriteError } from './assets/js/appwriteClient.js';

    const welcomeMsg = document.getElementById('welcomeMsg');
    const userInfoGrid = document.getElementById('userInfoGrid');
    const infoId = document.getElementById('infoId');
    const infoName = document.getElementById('infoName');
    const infoEmail = document.getElementById('infoEmail');
    const infoStatus = document.getElementById('infoStatus');
    const userAvatar = document.getElementById('userAvatar');
    const logoutBtn = document.getElementById('logoutBtn');
    const nameForm = document.getElementById('nameForm');
    const nameStatus = document.getElementById('nameStatus');
    const settingsThemeToggle = document.getElementById('settingsThemeToggle');
    const activityList = document.getElementById('activityList');

    let currentUser = null;

    // Initialize dashboard
    async function initDashboard() {
      try {
        currentUser = await account.get();
        loadUserProfile();
        loadUserStats();
        updateActivityFeed();
        calculateCompletion();
      } catch (err) {
        console.error('Authentication error:', err);
        welcomeMsg.textContent = 'Authentication required. Redirecting to login...';
        setTimeout(() => { 
          window.location.href = 'login.html?redirect=' + encodeURIComponent(window.location.pathname); 
        }, 1500);
      }
    }

    // Load user profile information
    function loadUserProfile() {
      if (!currentUser) return;
      
      welcomeMsg.textContent = `Welcome back, ${currentUser.name || 'friend'}! üëã`;
      
      // Update avatar with first letter of name
      const firstLetter = (currentUser.name || currentUser.email || 'U').charAt(0).toUpperCase();
      userAvatar.textContent = firstLetter;
      
      // Update user info
      infoId.textContent = currentUser.$id.substring(0, 8) + '...';
      infoName.textContent = currentUser.name || '‚Äî';
      infoEmail.textContent = currentUser.email;
      infoStatus.textContent = currentUser.emailVerification ? '‚úÖ Verified' : '‚ö†Ô∏è Unverified';
      
      userInfoGrid.style.display = 'grid';
    }

    // Load user statistics (simulated)
    function loadUserStats() {
      if (!currentUser) return;

      const createdDate = new Date(currentUser.$createdAt);
      const daysActive = Math.max(1, Math.floor((Date.now() - createdDate.getTime()) / (1000 * 60 * 60 * 24)));
      
      // Animate counters
      animateCounter('statDays', daysActive);
      animateCounter('statLogins', Math.floor(daysActive * 1.5) + 1);
      animateCounter('statUpdates', Math.floor(Math.random() * 5) + 1);
      animateCounter('statScore', Math.floor(daysActive * 10 + Math.random() * 50));
    }

    // Animate number counters
    function animateCounter(elementId, target) {
      const element = document.getElementById(elementId);
      const duration = 1500;
      const start = performance.now();
      
      function frame(now) {
        const progress = Math.min((now - start) / duration, 1);
        const eased = 1 - Math.pow(1 - progress, 3);
        element.textContent = Math.round(target * eased).toLocaleString();
        if (progress < 1) requestAnimationFrame(frame);
      }
      requestAnimationFrame(frame);
    }

    // Calculate profile completion
    function calculateCompletion() {
      if (!currentUser) return;
      
      let completion = 0;
      const checks = [
        currentUser.name && currentUser.name.length > 0, // 25%
        currentUser.emailVerification, // 25%
        currentUser.name && currentUser.name.length > 2, // 25%
        true // Account created - 25%
      ];
      
      completion = (checks.filter(Boolean).length / checks.length) * 100;
      
      const progressBar = document.getElementById('completionProgress');
      const progressText = document.getElementById('completionText');
      
      setTimeout(() => {
        progressBar.style.width = completion + '%';
        progressText.textContent = Math.round(completion) + '% Complete';
      }, 500);
    }

    // Update activity feed
    function updateActivityFeed() {
      const activities = [
        'Account dashboard accessed',
        'Profile information loaded',
        'Theme preferences synchronized',
        'Security status checked'
      ];
      
      const now = new Date();
      activities.forEach((activity, index) => {
        const time = new Date(now.getTime() - (index + 1) * 1000 * 60 * 5); // 5 min intervals
        const timeStr = time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        
        const li = document.createElement('li');
        li.className = 'activity-item';
        li.innerHTML = `
          ${activity}
          <div class="activity-time">${timeStr}</div>
        `;
        activityList.appendChild(li);
      });
    }

    // Event handlers
    logoutBtn.addEventListener('click', async () => {
      logoutBtn.disabled = true;
      logoutBtn.textContent = 'Signing out...';
      try {
        await account.deleteSession('current');
        window.location.href = 'login.html';
      } catch (err) {
        console.error('Logout error:', err);
        logoutBtn.textContent = 'Error';
        logoutBtn.disabled = false;
        setTimeout(() => {
          logoutBtn.textContent = 'Logout';
        }, 2000);
      }
    });

    nameForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const newName = document.getElementById('newName').value.trim();
      if (!newName) {
        nameStatus.textContent = 'Please enter a name.';
        nameStatus.style.color = 'var(--danger)';
        return;
      }
      
      nameStatus.textContent = 'Updating...';
      nameStatus.style.color = 'var(--text-soft)';
      try {
        currentUser = await account.updateName(newName);
        infoName.textContent = currentUser.name;
        userAvatar.textContent = currentUser.name.charAt(0).toUpperCase();
        welcomeMsg.textContent = `Welcome back, ${currentUser.name}! üëã`;
        nameStatus.textContent = '‚úÖ Name updated successfully';
        nameStatus.style.color = 'var(--ok)';
        document.getElementById('newName').value = '';
        
        // Update activity feed
        const li = document.createElement('li');
        li.className = 'activity-item';
        li.innerHTML = `
          Name updated to "${currentUser.name}"
          <div class="activity-time">Just now</div>
        `;
        activityList.insertBefore(li, activityList.firstChild);
        
        calculateCompletion();
        
        // Clear status after 3 seconds
        setTimeout(() => {
          nameStatus.textContent = '';
        }, 3000);
      } catch (err) {
        console.error('Name update error:', err);
        nameStatus.textContent = '‚ùå ' + handleAppwriteError(err);
        nameStatus.style.color = 'var(--danger)';
      }
    });

    settingsThemeToggle.addEventListener('click', () => {
      const themeToggle = document.getElementById('themeToggle');
      if (themeToggle) {
        themeToggle.click();
        
        // Add to activity feed
        const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
        const li = document.createElement('li');
        li.className = 'activity-item';
        li.innerHTML = `
          Theme changed to ${currentTheme} mode
          <div class="activity-time">Just now</div>
        `;
        activityList.insertBefore(li, activityList.firstChild);
      }
    });

    // Global functions for settings
    window.toggleNotifications = function() {
      alert('Email notifications feature coming soon!');
    };

    window.setup2FA = function() {
      alert('Two-factor authentication setup coming soon!');
    };

    window.exportData = function() {
      if (!currentUser) return;
      
      const data = {
        user: {
          id: currentUser.$id,
          name: currentUser.name,
          email: currentUser.email,
          verified: currentUser.emailVerification,
          created: currentUser.$createdAt
        },
        exported: new Date().toISOString()
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `dashboard-data-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      // Add to activity feed
      const li = document.createElement('li');
      li.className = 'activity-item';
      li.innerHTML = `
        Data exported successfully
        <div class="activity-time">Just now</div>
      `;
      activityList.insertBefore(li, activityList.firstChild);
    };

    // Initialize dashboard on load
    initDashboard();
  </script>
</body>
</html>