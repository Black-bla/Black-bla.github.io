<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Appwrite Configuration Check | Black-bla</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css" />
  <style>
    .config-wrapper{min-height:100svh;display:grid;place-items:center;padding:2rem 1rem}
    .config-card{width:100%;max-width:600px}
    .config-header{text-align:center;margin-bottom:2rem}
    .config-header h1{margin:0 0 .6rem;font-size:2rem;color:var(--accent)}
    .check-item{display:flex;align-items:center;justify-content:space-between;padding:1rem;margin-bottom:.8rem;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius-sm)}
    .check-status{padding:.3rem .6rem;border-radius:4px;font-size:.75rem;font-weight:600}
    .status-loading{background:rgba(255,193,7,0.2);color:#ffc107;border:1px solid rgba(255,193,7,0.3)}
    .status-success{background:rgba(16,185,129,0.2);color:#10b981;border:1px solid rgba(16,185,129,0.3)}
    .status-error{background:rgba(239,68,68,0.2);color:#ef4444;border:1px solid rgba(239,68,68,0.3)}
    .config-details{margin-top:1.5rem;padding:1rem;background:rgba(255,255,255,0.02);border-radius:var(--radius-sm);border:1px solid rgba(255,255,255,0.06)}
    .config-row{display:flex;justify-content:space-between;margin-bottom:.5rem;font-size:.85rem}
    .config-label{color:var(--text-soft)}
    .config-value{font-family:monospace;color:var(--text);word-break:break-all}
    .instructions{margin-top:2rem;padding:1.5rem;background:linear-gradient(to bottom right,rgba(99,102,241,0.1),rgba(139,92,246,0.05));border:1px solid rgba(99,102,241,0.2);border-radius:var(--radius)}
    .instructions h3{margin:0 0 1rem;color:var(--accent)}
    .instructions ol{margin:0;padding-left:1.2rem}
    .instructions li{margin-bottom:.5rem;line-height:1.4}
  </style>
</head>
<body>
  <canvas id="bg-canvas" aria-hidden="true"></canvas>
  <header class="site-header">
    <div class="logo"><a href="/" style="text-decoration:none;color:inherit">&lt;Black-bla /&gt;</a></div>
    <nav class="nav" aria-label="Primary">
      <button class="nav__toggle" aria-label="Menu" aria-expanded="false">â˜°</button>
      <ul class="nav__list">
        <li><a href="/">Home</a></li>
        <li><a href="login.html">Login</a></li>
      </ul>
    </nav>
    <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode">ðŸŒ™</button>
  </header>

  <main class="config-wrapper">
    <div class="card glass config-card">
      <div class="config-header">
        <h1>Appwrite Configuration Check</h1>
        <p class="muted">Verifying your Appwrite setup and connectivity</p>
      </div>
      
      <div class="check-item">
        <span>Client Configuration</span>
        <span class="check-status status-loading" id="clientStatus">Checking...</span>
      </div>
      
      <div class="check-item">
        <span>Project Connection</span>
        <span class="check-status status-loading" id="projectStatus">Checking...</span>
      </div>
      
      <div class="check-item">
        <span>Account Service</span>
        <span class="check-status status-loading" id="accountStatus">Checking...</span>
      </div>
      
      <div class="check-item">
        <span>Platform Configuration</span>
        <span class="check-status status-loading" id="platformStatus">Checking...</span>
      </div>

      <div class="config-details">
        <h3 style="margin:0 0 1rem;font-size:1rem">Configuration Details</h3>
        <div class="config-row">
          <span class="config-label">Endpoint:</span>
          <span class="config-value" id="endpointValue">Loading...</span>
        </div>
        <div class="config-row">
          <span class="config-label">Project ID:</span>
          <span class="config-value" id="projectIdValue">Loading...</span>
        </div>
        <div class="config-row">
          <span class="config-label">Current URL:</span>
          <span class="config-value" id="currentUrlValue">Loading...</span>
        </div>
        <div class="config-row">
          <span class="config-label">Environment:</span>
          <span class="config-value" id="environmentValue">Loading...</span>
        </div>
      </div>

      <div class="instructions">
        <h3>Setup Instructions</h3>
        <ol>
          <li><strong>Create Appwrite Project:</strong> Go to <a href="https://cloud.appwrite.io" target="_blank" style="color:var(--accent)">cloud.appwrite.io</a> and create a new project</li>
          <li><strong>Add Platform:</strong> In your project settings, add a Web Platform with your domain (e.g., <code>munguti.me</code> or <code>localhost:8000</code> for development)</li>
          <li><strong>Enable Auth:</strong> Go to Auth â†’ Settings and enable Email/Password authentication</li>
          <li><strong>Configure Project ID:</strong> Copy your project ID and update it in <code>assets/js/appwriteClient.js</code></li>
          <li><strong>Test:</strong> Refresh this page to verify the configuration</li>
        </ol>
      </div>

      <div style="text-align:center;margin-top:2rem">
        <button class="btn primary" onclick="window.location.reload()">Recheck Configuration</button>
        <a href="login.html" class="btn outline" style="margin-left:1rem">Go to Login</a>
      </div>
    </div>
  </main>

  <script type="module">
    import './assets/js/app.js';
    
    async function checkConfiguration() {
      const clientStatus = document.getElementById('clientStatus');
      const projectStatus = document.getElementById('projectStatus');
      const accountStatus = document.getElementById('accountStatus');
      const platformStatus = document.getElementById('platformStatus');
      
      const endpointValue = document.getElementById('endpointValue');
      const projectIdValue = document.getElementById('projectIdValue');
      const currentUrlValue = document.getElementById('currentUrlValue');
      const environmentValue = document.getElementById('environmentValue');

      // Set current environment info
      currentUrlValue.textContent = window.location.origin;
      environmentValue.textContent = window.location.hostname === 'localhost' ? 'Development' : 'Production';

      try {
        // Import Appwrite client
        const { client, account } = await import('./assets/js/appwriteClient.js');
        
        // Check client configuration
        endpointValue.textContent = client.config.endpoint || 'Not configured';
        projectIdValue.textContent = client.config.project || 'Not configured';
        
        if (client.config.endpoint && client.config.project) {
          clientStatus.textContent = 'Configured';
          clientStatus.className = 'check-status status-success';
        } else {
          clientStatus.textContent = 'Missing Config';
          clientStatus.className = 'check-status status-error';
          return;
        }

        // Test project connection
        try {
          // Try to get account (this will fail if not authenticated, but will still validate the project)
          await account.get();
          projectStatus.textContent = 'Connected';
          projectStatus.className = 'check-status status-success';
          accountStatus.textContent = 'Authenticated';
          accountStatus.className = 'check-status status-success';
          platformStatus.textContent = 'Configured';
          platformStatus.className = 'check-status status-success';
        } catch (err) {
          // Check error type to determine what's wrong
          if (err.code === 401 || err.type === 'general_unauthorized_scope') {
            // User not authenticated, but project connection works
            projectStatus.textContent = 'Connected';
            projectStatus.className = 'check-status status-success';
            accountStatus.textContent = 'Not Logged In';
            accountStatus.className = 'check-status status-success';
            platformStatus.textContent = 'Configured';
            platformStatus.className = 'check-status status-success';
          } else if (err.code === 404 || err.type === 'project_unknown') {
            projectStatus.textContent = 'Project Not Found';
            projectStatus.className = 'check-status status-error';
            accountStatus.textContent = 'Unavailable';
            accountStatus.className = 'check-status status-error';
            platformStatus.textContent = 'Check Project ID';
            platformStatus.className = 'check-status status-error';
          } else if (err.message && err.message.includes('CORS')) {
            projectStatus.textContent = 'CORS Error';
            projectStatus.className = 'check-status status-error';
            accountStatus.textContent = 'Unavailable';
            accountStatus.className = 'check-status status-error';
            platformStatus.textContent = 'Add Platform';
            platformStatus.className = 'check-status status-error';
          } else {
            projectStatus.textContent = 'Connection Error';
            projectStatus.className = 'check-status status-error';
            accountStatus.textContent = 'Unavailable';
            accountStatus.className = 'check-status status-error';
            platformStatus.textContent = 'Check Setup';
            platformStatus.className = 'check-status status-error';
          }
        }

      } catch (err) {
        console.error('Configuration check failed:', err);
        clientStatus.textContent = 'Import Error';
        clientStatus.className = 'check-status status-error';
        projectStatus.textContent = 'Cannot Test';
        projectStatus.className = 'check-status status-error';
        accountStatus.textContent = 'Cannot Test';
        accountStatus.className = 'check-status status-error';
        platformStatus.textContent = 'Cannot Test';
        platformStatus.className = 'check-status status-error';
        
        endpointValue.textContent = 'Error loading config';
        projectIdValue.textContent = 'Error loading config';
      }
    }

    // Run the configuration check
    checkConfiguration();
  </script>
</body>
</html>